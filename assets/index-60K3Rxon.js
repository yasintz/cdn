var m=Object.defineProperty;var y=(c,t,e)=>t in c?m(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var n=(c,t,e)=>(y(c,typeof t!="symbol"?t+"":t,e),e);import{r as S,j as v,F as w,a as d}from"./index-PRTzKQHk.js";class l{constructor(t,e){n(this,"x");n(this,"y");n(this,"add",t=>new l(this.x+t.x,this.y+t.y));n(this,"subtract",t=>new l(this.x-t.x,this.y-t.y));n(this,"divide",t=>new l(this.x-t.x,this.y-t.y));this.x=t,this.y=e}get distance(){return Math.sqrt(this.x*this.x+this.y*this.y)}get operator(){return{add:t=>new l(this.x+t,this.y+t),subtract:t=>new l(this.x-t,this.y-t),divide:t=>new l(this.x/t,this.y/t),multiplication:t=>new l(this.x*t,this.y*t)}}}class z{constructor(t){n(this,"params");n(this,"ctx");n(this,"canvas");n(this,"circleSizeRate",.0122);n(this,"spiralCenterWidth",.0732);n(this,"spiralStartPoint",0);n(this,"changeCircleSize",t=>{this.circleSizeRate=t});n(this,"changeSpiralCenterWidth",t=>{this.spiralCenterWidth=t});n(this,"changeSpiralStartPoint",t=>{this.spiralStartPoint=t});n(this,"getCanvas",()=>{const t=document.createElement("canvas");t.width=this.config.width,t.height=this.params.height,t.style.backgroundColor="white";const e=t.getContext("2d");return e.moveTo(this.config.centerOffset.x,this.config.centerOffset.y),e.textBaseline="middle",e.textAlign="center",{canvas:t,ctx:e}});n(this,"fillText",({style:t,text:e,offset:a})=>{this.ctx.font=`${t.fontSize}px Arial`,this.ctx.fillStyle=t.color,this.ctx.fillText(e,a.x,a.y)});n(this,"getAngle",t=>.01/this.config.quality*t);n(this,"getOffsetByIndex",t=>{const e=this.params.height*this.spiralCenterWidth,a=this.config.circleSize/2,o=this.getAngle(t),i=new l(Math.cos(o),Math.sin(o));return i.operator.multiplication(e).add(i.operator.multiplication(a*o)).add(this.config.centerOffset)});n(this,"drawArc",(t,e)=>{this.ctx.moveTo(t.x+e,t.y),this.ctx.arc(t.x,t.y,e,0,2*Math.PI,!0)});n(this,"draw",()=>{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const{title:t,items:e}=this.params.data;t&&this.fillText({style:this.style.title,text:t,offset:this.config.centerOffset});let a=this.getOffsetByIndex(1),o=Math.round(this.spiralStartPoint*this.params.data.items.length),i=0,g=1;for(;i<e.length;){g++;const s=this.getOffsetByIndex(g),r=s.subtract(a),p=r.distance>=this.config.circleSize*2+this.config.space;if(p&&o>0)o--,a=s;else if(p){const x=e[i];if(this.ctx.beginPath(),this.drawArc(s,this.config.circleSize),this.fillText({style:this.style.circleContent,offset:s,text:x.text}),x.bottomText&&this.fillText({style:this.style.bottomText,offset:s.add({x:0,y:this.style.circleContent.fontSize-this.style.bottomText.fontSize/2}),text:x.bottomText}),i>0){const f=s.subtract(r.operator.divide(2));this.drawArc(f,this.config.connectorSize)}a=s,i++,this.ctx.stroke()}}this.params.onDraw()});this.params=t;const{canvas:e,ctx:a}=this.getCanvas();this.ctx=a,this.canvas=e}get config(){const t=this.params.height*this.circleSizeRate,e=21*this.params.height/29;return{width:e,centerOffset:{x:e/2-t/3*2,y:this.params.height/2},circleSize:t,connectorSize:t/7.5,space:t/4,quality:80}}get style(){return{title:{color:"#808080",fontSize:this.params.height*.03},circleContent:{color:"#808080",fontSize:this.config.circleSize*.6},bottomText:{color:"#808080",fontSize:this.config.circleSize*.3}}}}let u=!1;function C(){var s;if(u)return;u=!0;let c;const t=document.getElementById("preview"),e=document.getElementById("circleSizeRange"),a=document.getElementById("spiralCenterWidthRange"),o=document.getElementById("spiralStartPointRange");let i;function g(r){const[h]=r.target.files,p=new FileReader;p.onload=function(x){c=JSON.parse(x.target.result),i&&i.canvas.remove(),i=new z({height:7e3,data:c,onDraw:()=>{if(i){const f=i.canvas.toDataURL("image/png");t.src=f}}}),i.draw()},p.readAsText(h)}(s=document.getElementById("upload"))==null||s.addEventListener("change",g,!1),e.addEventListener("change",r=>{const h=parseFloat(r.target.value);i&&(i.changeCircleSize(h),i.draw())}),a.addEventListener("change",r=>{const h=parseFloat(r.target.value);i&&(i.changeSpiralCenterWidth(h),i.draw())}),o.addEventListener("change",r=>{const h=parseFloat(r.target.value);i&&(i.changeSpiralStartPoint(h),i.draw())})}const I=()=>(S.useEffect(()=>{C()}),v(w,{children:[d("span",{children:"circleSizeRange"}),d("input",{id:"circleSizeRange",type:"range",min:"0",max:"0.3",step:"0.000001",value:"0.0122",style:{width:1500}}),d("span",{children:"spiralCenterWidthRange"}),d("input",{id:"spiralCenterWidthRange",type:"range",min:"0",max:"0.3",step:"0.000001",value:"0.0732",style:{width:1500}}),d("span",{children:"spiralStartPointRange"}),d("input",{id:"spiralStartPointRange",type:"range",min:"0",max:"1",step:"0.000001",value:"0",style:{width:1500}}),d("input",{id:"upload",type:"file",accept:"text/json",size:30}),d("img",{id:"preview"})]}));export{I as default};
