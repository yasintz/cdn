<!DOCTYPE html>
<html class="notion-html">
  <head lang="en">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"
    />
    <title></title>
    <link rel="icon" href="" />
    <style id="main-css">
      body {
        margin: 0;
      }
      body.dark {
        background: #2f3437;
      }
    </style>
  </head>
  <body class="notion-body hide-body dark">
    <div id="notion-app"></div>

    <script>
      const urlSearchParams = new URLSearchParams(window.location.search);
      window.$API_ID = urlSearchParams.get("api");
      async function app() {
        const content = document.getElementById("$content");
        const cover = document.getElementById("$cover");
        const title = document.getElementById("$title");
        const iconEl = document.querySelector("link[rel=icon]");
        const headTitle = document.querySelector("title");
        const blockTemplate = content.innerHTML;

        function buildApp(data) {
          localStorage.setItem(window.$API_ID, JSON.stringify(data));
          cover.src = data.cover;
          title.innerHTML = `${data.icon} ${data.title}`;
          iconEl.href = `data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>${
            data.icon
          }</text></svg>`;

          headTitle.innerText = data.title;

          const htmlList = [
            data.selfUrl
              ? {
                  image:
                    "https://images.unsplash.com/photo-1483736762161-1d107f3c78e1?&ixlib=rb-1.2.1&auto=format&fit=crop&w=1674&q=80",
                  title: "Update",
                  url: `https://www.npoint.io/docs/${window.$API_ID}`
                }
              : undefined,
            ...data.bookmarks
          ]
            .filter(i => i)
            .map((blockData, index) => {
              const block = {
                id: `block-${index}`,
                style: "",
                ...blockData
              };

              return Object.keys(block).reduce(
                (acc, cur) => acc.split(`{{${cur}}}`).join(block[cur]),
                blockTemplate
              );
            });

          content.innerHTML = htmlList.join("");
          document.body.classList.remove("hide-body");
        }

        const cache = localStorage.getItem(window.$API_ID);

        if (cache) {
          buildApp(JSON.parse(cache));
        }

        await fetch(`https://api.npoint.io/${window.$API_ID}`)
          .then(r => r.json())
          .then(buildApp);
      }
      async function load() {
        const res = await fetch(
          "https://api.npoint.io/9e0d06cf2a1b5d91ddd7"
        ).then(i => i.json());

        document.getElementById("notion-app").innerHTML = res.html;
      }
      load().then(app);
    </script>
  </body>
</html>
